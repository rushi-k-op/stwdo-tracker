name: Housing Monitor

on:
  schedule:
    - cron: '*/5 * * * *'
  workflow_dispatch:

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Run quick check
        env:
          NTFY_TOPIC: ${{ secrets.NTFY_TOPIC }}
        run: |
          # One-liner install + run
          pip install requests && python -c "
import requests, os
url = 'https://www.stwdo.de/en/living-houses-application/current-housing-offers'
topic = os.environ.get('NTFY_TOPIC')
try:
    r = requests.get(url, headers={'User-Agent': 'Mozilla/5.0'}, timeout=10)
    if 'No results found for the given search criteria'.lower() not in r.text.lower():
        requests.post(f'https://ntfy.sh/{topic}', data='üè† New apartment!', 
                     headers={'Title': 'Alert'}, timeout=3)
        print('‚úì Alert sent')
    else:
        print('‚úì No change')
except: print('‚úó Error')
          "
